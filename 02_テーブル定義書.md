---
tags:
created: 2025-08-05 10:25
updated: 2025-10-15 23:15
---
# PocketPantry テーブル定義書

## families テーブル

| フィールド名 | 型   | 制約             | 説明                               |
| ------------ | ---- | ---------------- | ---------------------------------- |
| id           | UUID | PK, NOT NULL     | ファミリーID（招待コードにも使用） |
| name         | text | NOT NULL         | ファミリーネーム                   |
| avatar_url   | text | NULLABLE         | アイコン画像URL                    |
| invite_code  | text | NOT NULL, UNIQUE | 招待コード（人が読める文字列）     |

## profiles テーブル

| フィールド名 | 型   | 制約                      | 説明                      |
| ------------ | ---- | ------------------------- | ------------------------- |
| id           | UUID | PK, NOT NULL              | Supabase AuthのユーザーID |
| family_id    | UUID | FK(families.id), NOT NULL | 所属ファミリーID          |
| name         | text | NOT NULL                  | ユーザー表示名            |

## items テーブル

| フィールド名      | 型        | 制約                         | 説明                                 |
| ----------------- | --------- | ---------------------------- | ------------------------------------ |
| id                | UUID      | PK, NOT NULL                 | 食材ID                               |
| family_id         | UUID      | FK(families.id), NOT NULL    | 所属ファミリーID                     |
| name              | text      | NOT NULL                     | 食材名                               |
| storage_category  | text      | NOT NULL                     | 保存場所（冷蔵／冷凍／常温／野菜室） |
| quantity          | integer   | NOT NULL, DEFAULT 1          | 在庫数                               |
| unit_id           | UUID      | FK(unit_master.id), NOT NULL | 単位ID（個／g／mlなど）              |
| item_status       | text      | NOT NULL, DEFAULT 'in_stock' | ステータス（in_stock / low / out）   |
| is_expiry_managed | boolean   | NOT NULL, DEFAULT true       | 賞味期限を管理するか                 |
| expiry_date       | date      | NULLABLE                     | 賞味期限                             |
| jan_code          | text      | NULLABLE                     | JANコード                            |
| memo              | text      | NULLABLE                     | 任意メモ                             |
| last_synced_token | text      | NULLABLE                     | 最終同期トークン                     |
| created_at        | timestamp | NOT NULL                     | 作成日時                             |
| updated_at        | timestamp | NOT NULL, DEFAULT now()      | 最終更新日時                         |

## unit_master テーブル

| フィールド名 | 型   | 制約         | 説明                         |
| ------------ | ---- | ------------ | ---------------------------- |
| id           | UUID | PK, NOT NULL | 単位ID                       |
| name         | text | NOT NULL     | 単位名（個／g／ml／本 など） |

## shopping_lists テーブル

| フィールド名 | 型        | 制約                      | 説明             |
| ------------ | --------- | ------------------------- | ---------------- |
| id           | UUID      | PK, NOT NULL              | 買い物リストID   |
| family_id    | UUID      | FK(families.id), NOT NULL | 所属ファミリーID |
| name         | text      | NOT NULL                  | リスト名         |
| created_at   | timestamp | NOT NULL, DEFAULT now()   | 作成日時         |

## shopping_list_items テーブル

| フィールド名     | 型        | 制約                            | 説明                                      |
| ---------------- | --------- | ------------------------------- | ----------------------------------------- |
| id               | UUID      | PK, NOT NULL                    | リスト明細ID                              |
| shopping_list_id | UUID      | FK(shopping_lists.id), NOT NULL | 紐付くリストID                            |
| item_id          | UUID      | FK(items.id), NULLABLE          | 紐付く食材ID（過去登録済みの場合）        |
| custom_name      | text      | NULLABLE                        | 自由記述の食材名（item_idがNULL時に使用） |
| quantity         | integer   | NOT NULL                        | 必要数                                    |
| is_checked       | boolean   | NOT NULL, DEFAULT false         | チェック状態                              |
| updated_at       | timestamp | NOT NULL, DEFAULT now()         |                                           |

## usage_logs テーブル

| フィールド名   | 型        | 制約                      | 説明                                    |
| -------------- | --------- | ------------------------- | --------------------------------------- |
| id             | UUID      | PK, NOT NULL              | ログID                                  |
| user_id        | UUID      | FK(profiles.id), NOT NULL | 実行ユーザーID                          |
| action_type    | text      | NOT NULL                  | アクション種別（ocr_scan など）         |
| parameter_json | jsonb     | NULLABLE                  | 追加パラメータ（OCR精度、ヒット率など） |
| created_at     | timestamp | NOT NULL, DEFAULT now()   | ログ作成日時                            |

## RLS (Row-Level Security) ポリシー概要

- profiles：ユーザー自身のみSELECT/UPDATE可能
- items：profiles.family_id = items.family_id のみアクセス可
- shopping_lists：profiles.family_id = shopping_lists.family_id のみアクセス可
- shopping_list_items：shopping_lists.family_id = profiles.family_id のみアクセス可
- usage_logs：user_idが一致するレコードのみアクセス可
- families：profiles.family_id = families.id のみアクセス可

---

## 備考

- storage_categoryはENUM管理 or Masterテーブル化はPhase2で検討
- unit_masterの初期データは「個」「g」「ml」「本」「袋」など
- item_statusは in_stock / low / out の3値
- is_expiry_managed = false の場合、expiry_dateはNULLでも許容
- last_synced_tokenは同期制御用トークン（Supabase Realtime用）
- invite_codeは家族招待用にhuman-readableな文字列を持たせる
