---
tags:
created: 2025-08-06 23:54
updated: 2025-10-15 23:10
---

# PocketPantry 画面遷移図 v2.0

_ゲストファーストアプローチによる画面フロー_

**更新日**: 2025年8月6日  
**版数**: v2.0（重要な設計変更を含む）

---

## 🎯 Phase 1: ゲストモード画面フロー

```mermaid
flowchart TD
  classDef guestScreen fill:#E8F5E8,stroke:#4CAF50,stroke-width:2px;
  classDef authScreen fill:#FFF3E0,stroke:#FF9800,stroke-width:2px;
  classDef premiumScreen fill:#F3E5F5,stroke:#9C27B0,stroke-width:2px;
  classDef action fill:#E3F2FD,stroke:#2196F3,stroke-width:2px;
  classDef decision fill:#FFEBEE,stroke:#F44336,stroke-width:2px;

  Start[アプリ起動] --> LoadCheck{ローカルデータ<br/>存在チェック}
  class LoadCheck decision

  LoadCheck -->|初回起動| EmptyInventory[在庫一覧画面<br/>（空状態）]
  LoadCheck -->|データあり| Inventory[在庫一覧画面<br/>（データ表示）]

  class EmptyInventory guestScreen
  class Inventory guestScreen

  %% 初回ユーザーガイド
  EmptyInventory --> GuideMessage[「まずは食材を<br/>登録しましょう！」<br/>ガイド表示]
  class GuideMessage action

  GuideMessage --> AddMethodSelect[登録方法選択]
  class AddMethodSelect action

  %% 食材登録フロー
  AddMethodSelect --> ManualInput[手動入力画面]
  AddMethodSelect --> BarcodeMode[バーコードスキャン<br/>（Phase 3で実装）]
  AddMethodSelect --> OCRMode[レシートOCR<br/>（Phase 3で実装）]

  class ManualInput guestScreen
  class BarcodeMode premiumScreen
  class OCRMode premiumScreen

  %% 手動入力フロー
  ManualInput --> CategorySelect[カテゴリ選択<br/>（冷蔵/冷凍/常温/野菜室）]
  class CategorySelect action
  CategorySelect --> ItemDetails[食材詳細入力<br/>（名前・数量・単位・期限）]
  class ItemDetails action
  ItemDetails --> SaveLocal[AsyncStorageに保存]
  class SaveLocal action
  SaveLocal --> Inventory

  %% メイン画面ナビゲーション
  Inventory --> InventoryTab[在庫タブ]
  Inventory --> ShoppingTab[買い物リストタブ]
  Inventory --> SettingsTab[設定タブ]

  class InventoryTab guestScreen
  class ShoppingTab guestScreen
  class SettingsTab guestScreen

  %% 在庫管理機能
  InventoryTab --> FilterCategory[カテゴリフィルタ]
  InventoryTab --> ItemDetail[食材詳細画面]
  InventoryTab --> EditItem[食材編集画面]
  InventoryTab --> AddItem[新規食材追加]

  class FilterCategory action
  class ItemDetail guestScreen
  class EditItem guestScreen
  class AddItem guestScreen

  AddItem --> AddMethodSelect

  %% 買い物リスト機能
  ShoppingTab --> CreateList[新規リスト作成]
  ShoppingTab --> ListDetail[リスト詳細画面]

  class CreateList action
  class ListDetail guestScreen

  ListDetail --> AddToList[アイテム追加]
  class AddToList action
  AddToList --> SuggestItems[過去食材から選択]
  AddToList --> FreewordInput[フリーワード入力]

  class SuggestItems action
  class FreewordInput action

  SuggestItems --> ListDetail
  FreewordInput --> ListDetail

  %% 通知機能（ローカル）
  Inventory --> NotificationCheck[賞味期限チェック<br/>（バックグラウンド）]
  class NotificationCheck action
  NotificationCheck --> LocalNotif[ローカル通知<br/>「卵の賞味期限です」]
  class LocalNotif action
  LocalNotif --> Inventory

  %% Phase 2への移行トリガー
  SettingsTab --> FamilyShare[家族共有ボタン]
  SettingsTab --> BackupData[データバックアップボタン]

  class FamilyShare authScreen
  class BackupData authScreen

  FamilyShare --> AuthPrompt[「家族共有するには<br/>アカウント登録が必要です」]
  BackupData --> AuthPrompt

  class AuthPrompt authScreen
```

---

## 🔄 Phase 2: 認証・家族共有フロー

```mermaid
flowchart TD
  classDef guestScreen fill:#E8F5E8,stroke:#4CAF50,stroke-width:2px;
  classDef authScreen fill:#FFF3E0,stroke:#FF9800,stroke-width:2px;
  classDef cloudScreen fill:#E1F5FE,stroke:#00BCD4,stroke-width:2px;
  classDef action fill:#E3F2FD,stroke:#2196F3,stroke-width:2px;
  classDef decision fill:#FFEBEE,stroke:#F44336,stroke-width:2px;

  AuthPrompt[アカウント登録プロンプト] --> UserChoice{ユーザー選択}
  class AuthPrompt authScreen
  class UserChoice decision

  UserChoice -->|後で| ContinueGuest[ゲストモード継続]
  UserChoice -->|登録する| EmailInput[メールアドレス入力画面]

  class ContinueGuest guestScreen
  class EmailInput authScreen

  %% 認証フロー
  EmailInput --> PasswordInput[パスワード設定画面]
  class PasswordInput authScreen
  PasswordInput --> SupabaseAuth[Supabase認証処理]
  class SupabaseAuth action

  SupabaseAuth --> AuthSuccess{認証成功？}
  class AuthSuccess decision
  AuthSuccess -->|失敗| EmailInput
  AuthSuccess -->|成功| FamilyChoice[ファミリー選択画面]

  class FamilyChoice authScreen

  %% ファミリー機能
  FamilyChoice --> CreateFamily[新規ファミリー作成]
  FamilyChoice --> JoinFamily[ファミリー参加<br/>（招待コード入力）]

  class CreateFamily authScreen
  class JoinFamily authScreen

  CreateFamily --> FamilySetup[ファミリー名設定]
  class FamilySetup authScreen
  FamilySetup --> GenerateInvite[招待コード生成]
  class GenerateInvite action

  JoinFamily --> ValidateCode{招待コード検証}
  class ValidateCode decision
  ValidateCode -->|無効| JoinFamily
  ValidateCode -->|有効| JoinSuccess[参加成功]
  class JoinSuccess action

  %% データ移行
  GenerateInvite --> DataMigration[ゲストデータ移行確認]
  JoinSuccess --> DataMigration
  class DataMigration action

  DataMigration --> MigrateLocal[AsyncStorage →<br/>Supabase移行]
  class MigrateLocal action
  MigrateLocal --> SyncComplete[移行完了]
  class SyncComplete action

  %% 認証後のメイン画面
  SyncComplete --> CloudInventory[在庫一覧画面<br/>（クラウド同期版）]
  class CloudInventory cloudScreen

  CloudInventory --> RealtimeSync[リアルタイム同期<br/>（家族間）]
  class RealtimeSync action
  RealtimeSync --> FamilyMembers[家族メンバー表示]
  class FamilyMembers cloudScreen
```

---

## 🚀 Phase 3: 高度機能フロー

```mermaid
flowchart TD
  classDef cloudScreen fill:#E1F5FE,stroke:#00BCD4,stroke-width:2px;
  classDef premiumScreen fill:#F3E5F5,stroke:#9C27B0,stroke-width:2px;
  classDef action fill:#E3F2FD,stroke:#2196F3,stroke-width:2px;
  classDef decision fill:#FFEBEE,stroke:#F44336,stroke-width:2px;

  CloudInventory[在庫一覧画面<br/>（認証済み）] --> PremiumFeatures[プレミアム機能メニュー]
  class CloudInventory cloudScreen
  class PremiumFeatures premiumScreen

  %% 写真機能
  PremiumFeatures --> PhotoCapture[食材写真撮影]
  class PhotoCapture premiumScreen
  PhotoCapture --> PhotoProcess[画像処理・圧縮]
  class PhotoProcess action
  PhotoProcess --> PhotoSave[FileSystem保存<br/>↓<br/>Supabase Storage]
  class PhotoSave action
  PhotoSave --> PhotoDisplay[写真付き食材表示]
  class PhotoDisplay premiumScreen

  %% OCR機能
  PremiumFeatures --> ReceiptOCR[レシート撮影]
  class ReceiptOCR premiumScreen
  ReceiptOCR --> OCRProcess[Google Vision API<br/>画像解析]
  class OCRProcess action
  OCRProcess --> OCRResults[認識結果確認画面]
  class OCRResults premiumScreen
  OCRResults --> BulkAdd[一括食材追加]
  class BulkAdd action

  %% バーコード機能
  PremiumFeatures --> BarcodeScanner[バーコードスキャナ]
  class BarcodeScanner premiumScreen
  BarcodeScanner --> JANLookup[JANコードAPI<br/>商品情報取得]
  class JANLookup action
  JANLookup --> ProductFound{商品情報<br/>取得成功？}
  class ProductFound decision
  ProductFound -->|成功| ProductDetails[商品詳細表示<br/>自動入力]
  ProductFound -->|失敗| ManualEntry[手動入力に切替]
  class ProductDetails premiumScreen
  class ManualEntry premiumScreen

  %% AI献立提案
  PremiumFeatures --> AIRecipe[AI献立提案]
  class AIRecipe premiumScreen
  AIRecipe --> AnalyzeInventory[在庫食材分析]
  class AnalyzeInventory action
  AnalyzeInventory --> GPTRequest[GPT-4o API<br/>献立生成]
  class GPTRequest action
  GPTRequest --> RecipeDisplay[提案献立表示]
  class RecipeDisplay premiumScreen
  RecipeDisplay --> AddMissing[不足食材を<br/>買い物リストに追加]
  class AddMissing action
```

---

## 🎨 カラールール（更新版）

### Phase別の色分け

- **🟢 ゲストモード (緑系)**: 即座に利用可能な基本機能
- **🟠 認証機能 (オレンジ系)**: アカウント登録・ファミリー機能
- **🔵 クラウド機能 (水色系)**: 認証後の高度な同期機能
- **🟣 プレミアム機能 (紫系)**: 将来の有料機能
- **⚪ アクション (青系)**: ユーザーアクション・処理
- **🔴 判定 (赤系)**: 条件分岐・判定処理

---

## 🔄 主要な変更点（v1.0 → v2.0）

### ❌ 削除された画面・フロー

- **初回ログイン強制画面**
- **強制的なファミリー作成プロセス**
- **サインアップ必須フロー**

### ✅ 新規追加された画面・フロー

- **ゲストモード在庫管理**
- **段階的認証プロンプト**
- **データ移行確認画面**
- **ローカル通知システム**

### 🔄 変更された画面・フロー

- **アプリ起動** → 即座に在庫一覧画面表示
- **認証タイミング** → 家族共有・バックアップ時のみ
- **データ保存** → ローカルファースト戦略

---

## 📱 ユーザージャーニー例

### 👤 初回ユーザー（田中さん）

```
アプリダウンロード
↓
在庫一覧画面（空）+ ガイド表示
↓
「卵」を手動入力
↓
3日後：賞味期限通知
↓
2週間後：家族共有したくなる
↓
アカウント登録プロンプト
↓
ファミリー作成・招待コード生成
```

### 👨‍👩‍👧‍👦 家族ユーザー（佐藤さん）

```
招待コード受信
↓
アプリダウンロード
↓
招待コード入力
↓
ファミリー参加成功
↓
リアルタイム同期で家族の在庫を確認
↓
買い物リスト更新
```

---

## 🎯 UX設計の意図

### 摩擦の最小化

- **0クリックで価値提供** - ダウンロード後即座に機能利用
- **段階的な情報提供** - 必要な時のみ詳細説明
- **価値実感後の登録促進** - 使ってみて便利だと感じてから

### エンゲージメント向上

- **即座のフィードバック** - 入力後すぐに結果表示
- **プログレッシブディスクロージャー** - 段階的な機能開示
- **コンテキストアウェアネス** - 適切なタイミングでの機能提案

---

**更新履歴**

- v1.0 (2025-08-05): 初版作成（認証優先フロー）
- v2.0 (2025-08-06): ゲストファーストアプローチへの全面改訂
